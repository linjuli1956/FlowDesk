# FlowDesk 目录结构说明

## 项目概述 v2025-08-30
FlowDesk 是一个基于 PyQt5 开发的 Windows 系统管理工具，采用标准分层架构设计，确保代码的可维护性和可扩展性。当前版本已完成网络配置Tab核心功能，包含完整的StylesheetService模块化样式管理系统。

## 实际目录结构快照 v2025-08-30
```
FlowDesk/
├── README.md                          # 项目说明文档  
├── requirements.txt                   # Python依赖包列表
├── run.py                            # 主程序启动入口
├── run.bat                           # Windows批处理启动脚本
├── debug_dns.py                      # DNS调试工具脚本
├── test_logging.py                   # 日志系统测试脚本
├── assets/                           # 静态资源目录
│   ├── LibreHardwareMonitor/         # 硬件监控库文件
│   │   ├── LibreHardwareMonitorLib.dll
│   │   ├── Aga.Controls.dll
│   │   ├── HidSharp.dll
│   │   └── [12个硬件监控相关文件]
│   └── icons/                        # 应用图标资源
│       ├── flowdesk.ico             # 主程序图标
│       ├── flowdesk_1024x1024.png   # 高分辨率图标
│       └── [9个不同尺寸图标文件]
├── backup/                           # 备份目录(空)
├── UI示例/                           # UI设计参考截图
│   ├── 360截图20250826222150690.jpg  # 主界面截图
│   ├── 360截图20250827004750392.jpg  # 网络配置页面
│   └── [14个UI参考截图文件]
├── config/                           # 配置文件目录
│   ├── __init__.py                  # 配置包初始化
│   ├── development.py               # 开发环境配置
│   ├── production.py                # 生产环境配置  
│   ├── settings.py                  # 通用配置设置
│   └── logging.conf                 # 日志配置文件
├── data/                            # 数据存储目录
│   └── development/                 # 开发环境数据(空)
├── docs/                            # 项目文档目录
│   ├── README.md                    # 主文档
│   ├── 开发路线图 (Roadmap) 与优先级.md
│   ├── 目录结构说明.md              # 本文档
│   ├── 项目架构设计说明书.md
│   ├── UI组件与样式规范（CLAYMORPHISM）.md  
│   ├── 数据流与状态管理设计.md
│   ├── 未来功能开发规划.md
│   ├── 网络配置Tab核心功能实现总结.md
│   └── __init__.py                  # 文档包标识
├── logs/                            # 日志文件目录
│   ├── development/                 # 开发环境日志
│   ├── flowdesk.log                # 主日志文件
│   └── error.log                   # 错误日志文件
├── myplan/                          # 开发计划文档
│   ├── UI开发计划-创建主窗口及系统托盘.md
│   ├── UI开发计划2-设计第一个tab页面.md
│   ├── UI注意事项.md
│   ├── 全面样式架构审计.md
│   └── [5个开发计划相关文档]
├── scripts/                         # 构建和工具脚本
│   └── __init__.py                 # 脚本包标识
├── tests/                            # 测试目录  
│   ├── __init__.py                  # 测试包初始化
│   ├── conftest.py                  # pytest配置和fixtures
│   ├── unit/                        # 单元测试
│   │   ├── __init__.py              
│   │   ├── test_models/             # 模型层测试
│   │   ├── test_services/           # 服务层测试
│   │   └── test_utils/              # 工具层测试
│   ├── integration/                 # 集成测试
│   │   └── __init__.py
│   └── fixtures/                    # 测试数据和模拟对象
│       └── __init__.py
└── src/                             # 源代码根目录
    └── flowdesk/                    # 主应用包
        ├── __init__.py              # 包初始化文件
        ├── app.py                   # 应用程序入口点
        ├── main.py                  # 主启动模块
        ├── models/                  # 数据模型层
        │   ├── __init__.py          
        │   ├── adapter_info.py      # 网络适配器信息模型(245行)
        │   ├── common.py            # 通用数据模型
        │   ├── hardware_metrics.py  # 硬件监控数据模型
        │   ├── network_tools.py     # 网络工具相关模型  
        │   └── rdp_session.py       # 远程桌面会话模型
        ├── services/                # 业务服务层
        │   ├── __init__.py          
        │   ├── network_service.py   # 网络配置服务(2352行)
        │   ├── stylesheet_service.py # 样式表管理服务  
        │   └── system_tray_service.py # 系统托盘服务
        ├── ui/                      # 用户界面层
        │   ├── __init__.py
        │   ├── main_window.py       # 主窗口(1145行)
        │   ├── dialogs/             # 对话框组件
        │   │   ├── __init__.py
        │   │   └── add_ip_dialog.py # 添加IP对话框
        │   ├── qss/                 # 模块化QSS样式文件(8个)
        │   │   ├── __init__.py
        │   │   ├── main_pyqt5.qss   # 主样式文件
        │   │   ├── network_config_tab.qss # 网络配置Tab样式
        │   │   ├── network_tools_tab.qss  # 网络工具Tab样式
        │   │   ├── rdp_tab.qss      # 远程桌面Tab样式
        │   │   ├── hardware_tab.qss # 硬件信息Tab样式
        │   │   ├── tray_exit_dialog.qss # 托盘对话框样式
        │   │   ├── add_ip_dialog.qss # 添加IP对话框样式
        │   │   └── main_window.qss  # 主窗口样式
        │   ├── styles/              # 颜色方案定义
        │   │   ├── __init__.py
        │   │   └── color_scheme.py  # 颜色常量定义
        │   ├── tabs/                # Tab页面组件
        │   │   ├── __init__.py
        │   │   └── network_config_tab.py # 网络配置页面(1039行)
        │   └── widgets/             # 自定义控件
        │       ├── __init__.py
        │       └── validators.py    # 输入验证器
        └── utils/                   # 工具函数层
            ├── __init__.py
            ├── admin_utils.py       # 管理员权限工具
            ├── capabilities.py      # 系统能力检测
            ├── logger.py            # 日志管理工具
            ├── network_utils.py     # 网络工具函数
            ├── resource_path.py     # 资源路径管理
            └── subprocess_helper.py # 子进程辅助工具
```

## 核心代码结构详解 v2025-08-30

### 1. 数据模型层 (models/) - 已完成
```
src/flowdesk/models/
├── __init__.py                        # 模型层包初始化
├── adapter_info.py (245行)            # ✅ 网络适配器信息模型
│   ├── AdapterInfo                    # 网卡完整信息(基本+配置+性能)
│   ├── IPConfigInfo                   # IP配置信息传输模型
│   ├── ExtraIP                        # 额外IP地址信息
│   └── DnsConfig                      # DNS配置信息
├── common.py                          # 通用数据模型(未实现)
├── hardware_metrics.py                # 硬件监控数据模型(未实现)
├── network_tools.py                   # 网络工具相关模型(未实现)
└── rdp_session.py                     # 远程桌面会话模型(未实现)
```

**当前实现状态**：
- ✅ **AdapterInfo**: 完整的网卡信息模型，支持主IP/额外IP智能分类
- ✅ **IPConfigInfo**: IP配置传输契约，UI层与服务层标准接口
- ✅ **ExtraIP**: 额外IP地址管理，支持批量操作
- ✅ **DnsConfig**: DNS服务器配置模型

### 2. 业务服务层 (services/) - 部分完成
```
src/flowdesk/services/
├── __init__.py                        # 服务层包初始化
├── network_service.py (2352行)        # ✅ 网络配置服务(待拆包)
│   ├── ✅ 网卡发现与枚举(WMIC+智能排序)
│   ├── ✅ 网卡详细信息获取(netsh+ipconfig)
│   ├── ✅ 双重状态判断(管理状态+连接状态)  
│   ├── ✅ 网卡性能信息(链路速度+硬件描述)
│   ├── ✅ IP配置应用(静态IP+DNS设置)
│   ├── ✅ 额外IP管理(批量添加/删除)
│   ├── ✅ UI交互协调(选择+刷新+复制)
│   └── ✅ 工具方法(子网掩码转换+编码清理)
├── stylesheet_service.py (270行)      # ✅ 样式表管理服务
│   ├── ✅ 模块化QSS文件加载(8个文件)
│   ├── ✅ 按顺序合并避免冲突
│   ├── ✅ Win7兼容模式切换
│   └── ✅ 统一样式应用接口
├── system_tray_service.py (365行)     # ✅ 系统托盘服务
│   ├── ✅ 托盘图标管理
│   ├── ✅ 右键菜单功能  
│   └── ✅ 后台运行支持
└── [待实现服务类]
    ├── hardware_monitor_service.py    # 硬件监控服务(未实现)
    ├── rdp_service.py                 # 远程桌面服务(未实现)  
    └── network_tools_service.py       # 网络工具服务(未实现)
```

**当前实现状态**：
- ✅ **NetworkService**: 功能完整但需拆包重构(2352行→8个专业服务类)
- ✅ **StylesheetService**: 模块化QSS管理系统，支持8个样式文件
- ✅ **SystemTrayService**: 完整的托盘功能实现
- 🚧 **拆包计划**: NetworkService按8个功能域拆分为专业服务类

### 3. 用户界面层 (ui/)
```
src/flowdesk/ui/
├── __init__.py                        # UI层包初始化
├── main_window.py                     # 主窗口类
│   ├── 660×645像素窗口布局
│   ├── 四个Tab页面容器
│   ├── 状态栏和菜单栏
│   └── 信号槽连接管理
├── tabs/                              # Tab页面组件
│   ├── __init__.py
│   ├── network_config_tab.py          # 网络配置页面
│   │   ├── 网卡选择下拉框
│   │   ├── IP信息展示容器
│   │   ├── 状态徽章显示
│   │   ├── IP配置输入区域
│   │   ├── 操作按钮组
│   │   └── 额外IP管理列表
│   ├── network_tools_tab.py           # 网络工具页面
│   │   ├── 连通性测试区域
│   │   ├── 9宫格系统工具按钮
│   │   └── 密码设置功能
│   ├── rdp_tab.py                     # 远程桌面页面
│   │   ├── 连接说明区域
│   │   └── 连接按钮
│   └── hardware_tab.py                # 硬件信息页面
│       ├── 操作按钮区域
│       ├── 硬件信息卡片容器
│       └── 悬浮窗控制
├── dialogs/                           # 对话框组件
│   ├── __init__.py
│   ├── rdp_connect_dialog.py          # RDP连接配置对话框
│   ├── add_ip_dialog.py               # 添加IP地址对话框
│   ├── user_management_dialog.py      # 用户管理对话框
│   └── float_window_settings_dialog.py # 悬浮窗设置对话框
├── widgets/                           # 自定义控件
│   ├── __init__.py
│   ├── float_window.py                # 硬件监控悬浮窗
│   ├── status_badge.py                # 状态徽章控件
│   ├── ping_result_widget.py          # Ping结果显示控件
│   └── hardware_card.py               # 硬件信息卡片控件
├── qss/                               # 模块化QSS样式文件
│   ├── main_pyqt5.qss                 # Win10/11主样式表
│   ├── main_win7.qss                  # Win7兼容样式表
│   ├── network_config_tab.qss         # 网络配置Tab样式
│   ├── network_tools_tab.qss          # 网络工具Tab样式
│   ├── rdp_tab.qss                    # 远程桌面Tab样式
│   ├── hardware_tab.qss               # 硬件信息Tab样式
│   └── tray_exit_dialog.qss           # 托盘对话框样式
└── styles/                            # 颜色方案定义
    ├── __init__.py
    └── color_scheme.py                # 颜色常量定义
```

**职责说明**：
- 纯视图层，零业务逻辑
- 响应用户交互事件
- 订阅服务层信号更新界面
- 应用外置QSS样式

### 4. 工具函数层 (utils/)
```
src/flowdesk/utils/
├── __init__.py                        # 工具层包初始化
├── logger.py                          # 日志管理工具
│   ├── 结构化日志记录
│   ├── 日志级别控制
│   └── 文件日志输出
├── resource_path.py                   # 资源路径管理
│   ├── 打包后资源定位
│   ├── 开发环境路径处理
│   └── 跨平台路径兼容
├── capabilities.py                    # 系统能力检测
│   ├── Windows版本检测
│   ├── 权限状态检查
│   ├── 功能可用性验证
│   └── Win7兼容性处理
├── subprocess_helper.py               # 子进程管理工具
│   ├── 安全的命令执行
│   ├── 超时控制
│   └── 输出解析
├── network_utils.py                   # 网络工具函数
│   ├── IP地址验证
│   ├── 网络接口操作
│   └── 网络状态检测
├── registry_helper.py                 # 注册表操作工具
│   ├── 安全的注册表读写
│   ├── Win11自动登录配置
│   └── 错误处理
└── encryption.py                      # 加密工具
    ├── RDP凭据加密存储
    ├── 配置文件加密
    └── 密钥管理
```

**职责说明**：
- 提供通用工具函数
- 封装系统API调用
- 处理跨平台兼容性
- 提供安全的操作封装

## 设计原则

### 1. 分层架构约束
- **UI层**：严禁业务逻辑，只负责界面展示和用户交互
- **服务层**：封装所有业务逻辑，通过信号与UI通信
- **模型层**：定义数据契约，提供类型安全
- **工具层**：提供通用功能，被服务层调用

### 2. 通信机制
- UI → 服务：方法调用
- 服务 → UI：PyQt信号
- 数据传递：统一使用模型类，禁止原始字典

### 3. 样式管理
- 模块化QSS文件管理，由StylesheetService统一加载
- 禁止内联样式，严格使用外置QSS
- 支持Win7兼容模式自动切换
- 按优先级顺序合并样式文件

### 4. 资源管理
- 图标和DLL文件统一放在assets/目录
- 通过resource_path()函数定位资源
- 支持打包后的资源访问

## 开发规范

### 1. 命名规范
- 文件名：snake_case（如network_service.py）
- 类名：PascalCase（如NetworkService）
- 方法名：snake_case（如get_adapter_info）
- 常量：UPPER_CASE（如DEFAULT_TIMEOUT）

### 2. 导入规范
```python
# 标准库导入
import os
import sys
from typing import Optional, List

# 第三方库导入
from PyQt5.QtCore import QObject, pyqtSignal
from PyQt5.QtWidgets import QWidget

# 本地导入
from ..models.adapter_info import AdapterInfo
from ..utils.logger import get_logger
```

### 3. 注释规范
- 类和方法必须有中文文档字符串
- 复杂逻辑需要行内注释说明
- 重要的业务规则需要详细注释

### 4. 错误处理
- 统一使用ErrorInfo模型传递错误信息
- 服务层负责捕获和处理所有异常
- UI层只负责显示错误信息

## 构建和部署

### 1. 开发环境
```bash
# 安装依赖
pip install -r requirements.txt

# 运行应用
python src/flowdesk/app.py
```

### 2. 打包构建
```bash
# 使用PyInstaller打包
pyinstaller --onefile --windowed \
    --add-data "assets;assets" \
    --icon="assets/icons/flowdesk.ico" \
    src/flowdesk/app.py
```

### 3. 兼容性
- **Windows 10/11**：完整功能支持
- **Windows 7**：基础功能支持，部分高级功能降级

## 扩展指南

### 1. 添加新功能
1. 在models/中定义数据模型
2. 在services/中实现业务逻辑
3. 在ui/中创建界面组件
4. 更新相关文档

### 2. 添加新的Tab页面
1. 在ui/tabs/中创建新的Tab类
2. 在main_window.py中注册Tab
3. 在qss/中添加相应样式
4. 更新objectName命名文档

### 3. 集成新的系统工具
1. 在services/network_tools_service.py中添加方法
2. 在ui/tabs/network_tools_tab.py中添加按钮
3. 定义相应的信号和槽函数
4. 更新按钮颜色方案

这个目录结构确保了代码的清晰组织、易于维护和扩展，同时遵循了现代软件开发的最佳实践。
