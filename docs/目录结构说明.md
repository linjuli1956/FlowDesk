# FlowDesk 目录结构说明

## 项目概述
FlowDesk 是一个基于 PyQt5 开发的 Windows 系统管理工具，采用标准分层架构设计，确保代码的可维护性和可扩展性。

## 根目录结构
```
FlowDesk/
├── README.md                           # 项目说明文档
├── requirements.txt                    # Python依赖包列表
├── requirements-dev.txt                # 开发依赖包列表
├── setup.py                            # 包安装配置
├── pyproject.toml                      # 现代Python项目配置
├── pytest.ini                         # pytest配置
├── .gitignore                          # Git忽略文件
├── .pylintrc                           # 代码检查配置
├── Makefile                            # 构建命令快捷方式
├── 功能说明1.md                        # 详细功能需求文档1
├── 功能说明2.md                        # 详细功能需求文档2
├── 未来功能开发规划.md                  # v2.0功能规划文档
├── 项目架构设计说明书.md                # 架构设计核心文档
├── UI组件与样式规范（CLAYMORPHISM）.md   # UI设计规范文档
├── 数据流与状态管理设计.md              # 数据流设计文档
├── 开发路线图 (Roadmap) 与优先级.md     # 开发计划文档
├── 目录结构说明.md                     # 本文档
├── assets/                             # 静态资源目录
│   ├── LibreHardwareMonitor/           # 硬件监控库文件
│   │   ├── LibreHardwareMonitorLib.dll # 硬件监控核心库
│   │   ├── Aga.Controls.dll           # 控件库
│   │   ├── HidSharp.dll               # HID设备支持
│   │   └── ...                        # 其他依赖文件
│   └── icons/                          # 应用图标资源
│       ├── flowdesk.ico               # 主程序图标
│       ├── flowdesk_1024x1024.png     # 高分辨率图标
│       └── ...                        # 其他尺寸图标
├── UI示例/                             # UI设计参考截图
│   ├── 360截图20250826222150690.jpg    # 主界面截图
│   ├── 360截图20250827004750392.jpg    # 网络配置页面
│   └── ...                            # 其他UI参考图
├── config/                             # 配置文件目录
│   ├── __init__.py                    # 配置包初始化
│   ├── settings.py                    # 默认配置
│   ├── development.py                 # 开发环境配置
│   ├── production.py                  # 生产环境配置
│   └── logging.conf                   # 日志配置文件
├── scripts/                            # 构建和部署脚本
│   ├── build.py                       # 构建脚本
│   ├── setup_dev.py                   # 开发环境设置
│   ├── generate_qss.py                # QSS样式生成脚本
│   └── package.py                     # 打包脚本
├── tests/                              # 测试目录
│   ├── __init__.py                    # 测试包初始化
│   ├── conftest.py                    # pytest配置和fixtures
│   ├── unit/                          # 单元测试
│   │   ├── __init__.py
│   │   ├── test_models/               # 模型层测试
│   │   ├── test_services/             # 服务层测试
│   │   └── test_utils/                # 工具层测试
│   ├── integration/                   # 集成测试
│   │   ├── __init__.py
│   │   ├── test_ui_service_integration.py
│   │   └── test_system_integration.py
│   └── fixtures/                      # 测试数据和模拟对象
│       ├── mock_adapters.json
│       ├── mock_hardware_data.json
│       └── test_rdp_sessions.json
├── docs/                               # 文档目录
│   ├── api/                           # API文档
│   ├── user_guide/                    # 用户指南
│   ├── developer_guide/               # 开发者指南
│   └── changelog.md                   # 版本更新日志
└── src/                               # 源代码根目录
    └── flowdesk/                      # 主应用包（统一命名）
        ├── __init__.py                # 包初始化文件
        ├── app.py                     # 应用程序入口点
        ├── models/                    # 数据模型层
        ├── services/                  # 业务服务层
        │   ├── __init__.py
        │   ├── system_tray_service.py # 系统托盘服务
        │   └── stylesheet_service.py  # 样式表管理服务（新增）
        ├── ui/                        # 用户界面层
        │   ├── __init__.py
        │   ├── main_window.py         # 主窗口
        │   ├── tabs/                  # Tab页面组件
        │   ├── qss/                   # 模块化QSS样式文件
        │   │   ├── main_pyqt5.qss     # 主样式文件
        │   │   ├── network_config_tab.qss # 网络配置Tab样式
        │   │   ├── network_tools_tab.qss  # 网络工具Tab样式
        │   │   ├── rdp_tab.qss        # 远程桌面Tab样式
        │   │   ├── hardware_tab.qss   # 硬件信息Tab样式
        │   │   └── tray_exit_dialog.qss # 托盘对话框样式
        │   └── styles/                # 颜色方案定义
        │       └── color_scheme.py       # 颜色常量定义
        └── utils/                     # 工具函数层
```

## 核心代码结构详解

### 1. 数据模型层 (models/)
```
src/flowdesk/models/
├── __init__.py                        # 模型层包初始化
├── adapter_info.py                    # 网络适配器信息模型
│   ├── AdapterInfo                    # 网卡基本信息
│   ├── IPConfigInfo                   # IP配置信息
│   └── DnsConfig                      # DNS配置信息
├── hardware_metrics.py                # 硬件监控数据模型
│   ├── HardwareMetrics                # 实时硬件指标
│   ├── HardwareInfo                   # 硬件详细信息
│   └── FloatWindowSettings            # 悬浮窗配置
├── rdp_session.py                     # 远程桌面会话模型
│   ├── RdpSession                     # RDP会话信息
│   └── RdpTarget                      # RDP连接目标
├── network_tools.py                   # 网络工具相关模型
│   ├── PingResult                     # Ping测试结果
│   ├── TracertHop                     # 路由跳点信息
│   └── SystemToolResult               # 系统工具执行结果
└── common.py                          # 通用数据模型
    ├── ProgressInfo                   # 操作进度信息
    ├── ErrorInfo                      # 错误信息
    └── Capabilities                   # 系统能力信息
```

**职责说明**：
- 定义所有数据结构和类型
- 提供基本的数据验证和转换
- 作为UI层和服务层之间的数据契约
- 避免使用原始字典传递数据

### 2. 业务服务层 (services/)
```
src/flowdesk/services/
├── __init__.py                        # 服务层包初始化
├── base_service.py                    # 服务基类，定义通用信号
├── network_service.py                 # 网络配置服务
│   ├── 网卡枚举和状态管理
│   ├── IP/DNS配置管理
│   ├── 网卡启用/禁用控制
│   └── 额外IP地址管理
│   └── 浏览器缓存清理
├── rdp_service.py                     # 远程桌面服务
│   ├── RDP连接管理
│   ├── 历史记录持久化
│   ├── 分组管理功能
│   └── 凭据安全存储
├── hardware_monitor_service.py        # 硬件监控服务
│   ├── LibreHardwareMonitor集成
│   ├── 实时数据采集
│   ├── 悬浮窗数据推送
│   └── 阶梯颜色计算
├── settings_service.py                # 配置管理服务
│   ├── 用户偏好设置
│   ├── 配置文件持久化
│   └── 默认值管理
├── system_tray_service.py             # 系统托盘服务
│   ├── 托盘图标管理
│   ├── 右键菜单功能
│   └── 后台运行支持
├── stylesheet_service.py              # 样式表管理服务（新增）
│   ├── 模块化QSS文件加载和合并
│   ├── 按顺序读取样式文件，避免冲突
│   ├── 统一样式应用和热重载支持
│   └── 可扩展的样式文件管理架构
└── validation_service.py              # 输入验证服务
    ├── IP地址格式验证
    ├── 网络配置合规检查
    └── 统一验证规则
```

**职责说明**：
- 封装所有业务逻辑和系统调用
- 通过PyQt信号与UI层通信
- 处理长时间运行的任务
- 提供错误处理和进度反馈

### 3. 用户界面层 (ui/)
```
src/flowdesk/ui/
├── __init__.py                        # UI层包初始化
├── main_window.py                     # 主窗口类
│   ├── 660×645像素窗口布局
│   ├── 四个Tab页面容器
│   ├── 状态栏和菜单栏
│   └── 信号槽连接管理
├── tabs/                              # Tab页面组件
│   ├── __init__.py
│   ├── network_config_tab.py          # 网络配置页面
│   │   ├── 网卡选择下拉框
│   │   ├── IP信息展示容器
│   │   ├── 状态徽章显示
│   │   ├── IP配置输入区域
│   │   ├── 操作按钮组
│   │   └── 额外IP管理列表
│   ├── network_tools_tab.py           # 网络工具页面
│   │   ├── 连通性测试区域
│   │   ├── 9宫格系统工具按钮
│   │   └── 密码设置功能
│   ├── rdp_tab.py                     # 远程桌面页面
│   │   ├── 连接说明区域
│   │   └── 连接按钮
│   └── hardware_tab.py                # 硬件信息页面
│       ├── 操作按钮区域
│       ├── 硬件信息卡片容器
│       └── 悬浮窗控制
├── dialogs/                           # 对话框组件
│   ├── __init__.py
│   ├── rdp_connect_dialog.py          # RDP连接配置对话框
│   ├── add_ip_dialog.py               # 添加IP地址对话框
│   ├── user_management_dialog.py      # 用户管理对话框
│   └── float_window_settings_dialog.py # 悬浮窗设置对话框
├── widgets/                           # 自定义控件
│   ├── __init__.py
│   ├── float_window.py                # 硬件监控悬浮窗
│   ├── status_badge.py                # 状态徽章控件
│   ├── ping_result_widget.py          # Ping结果显示控件
│   └── hardware_card.py               # 硬件信息卡片控件
├── qss/                               # 模块化QSS样式文件
│   ├── main_pyqt5.qss                 # Win10/11主样式表
│   ├── main_win7.qss                  # Win7兼容样式表
│   ├── network_config_tab.qss         # 网络配置Tab样式
│   ├── network_tools_tab.qss          # 网络工具Tab样式
│   ├── rdp_tab.qss                    # 远程桌面Tab样式
│   ├── hardware_tab.qss               # 硬件信息Tab样式
│   └── tray_exit_dialog.qss           # 托盘对话框样式
└── styles/                            # 颜色方案定义
    ├── __init__.py
    └── color_scheme.py                # 颜色常量定义
```

**职责说明**：
- 纯视图层，零业务逻辑
- 响应用户交互事件
- 订阅服务层信号更新界面
- 应用外置QSS样式

### 4. 工具函数层 (utils/)
```
src/flowdesk/utils/
├── __init__.py                        # 工具层包初始化
├── logger.py                          # 日志管理工具
│   ├── 结构化日志记录
│   ├── 日志级别控制
│   └── 文件日志输出
├── resource_path.py                   # 资源路径管理
│   ├── 打包后资源定位
│   ├── 开发环境路径处理
│   └── 跨平台路径兼容
├── capabilities.py                    # 系统能力检测
│   ├── Windows版本检测
│   ├── 权限状态检查
│   ├── 功能可用性验证
│   └── Win7兼容性处理
├── subprocess_helper.py               # 子进程管理工具
│   ├── 安全的命令执行
│   ├── 超时控制
│   └── 输出解析
├── network_utils.py                   # 网络工具函数
│   ├── IP地址验证
│   ├── 网络接口操作
│   └── 网络状态检测
├── registry_helper.py                 # 注册表操作工具
│   ├── 安全的注册表读写
│   ├── Win11自动登录配置
│   └── 错误处理
└── encryption.py                      # 加密工具
    ├── RDP凭据加密存储
    ├── 配置文件加密
    └── 密钥管理
```

**职责说明**：
- 提供通用工具函数
- 封装系统API调用
- 处理跨平台兼容性
- 提供安全的操作封装

## 设计原则

### 1. 分层架构约束
- **UI层**：严禁业务逻辑，只负责界面展示和用户交互
- **服务层**：封装所有业务逻辑，通过信号与UI通信
- **模型层**：定义数据契约，提供类型安全
- **工具层**：提供通用功能，被服务层调用

### 2. 通信机制
- UI → 服务：方法调用
- 服务 → UI：PyQt信号
- 数据传递：统一使用模型类，禁止原始字典

### 3. 样式管理
- 模块化QSS文件管理，由StylesheetService统一加载
- 禁止内联样式，严格使用外置QSS
- 支持Win7兼容模式自动切换
- 按优先级顺序合并样式文件

### 4. 资源管理
- 图标和DLL文件统一放在assets/目录
- 通过resource_path()函数定位资源
- 支持打包后的资源访问

## 开发规范

### 1. 命名规范
- 文件名：snake_case（如network_service.py）
- 类名：PascalCase（如NetworkService）
- 方法名：snake_case（如get_adapter_info）
- 常量：UPPER_CASE（如DEFAULT_TIMEOUT）

### 2. 导入规范
```python
# 标准库导入
import os
import sys
from typing import Optional, List

# 第三方库导入
from PyQt5.QtCore import QObject, pyqtSignal
from PyQt5.QtWidgets import QWidget

# 本地导入
from ..models.adapter_info import AdapterInfo
from ..utils.logger import get_logger
```

### 3. 注释规范
- 类和方法必须有中文文档字符串
- 复杂逻辑需要行内注释说明
- 重要的业务规则需要详细注释

### 4. 错误处理
- 统一使用ErrorInfo模型传递错误信息
- 服务层负责捕获和处理所有异常
- UI层只负责显示错误信息

## 构建和部署

### 1. 开发环境
```bash
# 安装依赖
pip install -r requirements.txt

# 运行应用
python src/flowdesk/app.py
```

### 2. 打包构建
```bash
# 使用PyInstaller打包
pyinstaller --onefile --windowed \
    --add-data "assets;assets" \
    --icon="assets/icons/flowdesk.ico" \
    src/flowdesk/app.py
```

### 3. 兼容性
- **Windows 10/11**：完整功能支持
- **Windows 7**：基础功能支持，部分高级功能降级

## 扩展指南

### 1. 添加新功能
1. 在models/中定义数据模型
2. 在services/中实现业务逻辑
3. 在ui/中创建界面组件
4. 更新相关文档

### 2. 添加新的Tab页面
1. 在ui/tabs/中创建新的Tab类
2. 在main_window.py中注册Tab
3. 在qss/中添加相应样式
4. 更新objectName命名文档

### 3. 集成新的系统工具
1. 在services/network_tools_service.py中添加方法
2. 在ui/tabs/network_tools_tab.py中添加按钮
3. 定义相应的信号和槽函数
4. 更新按钮颜色方案

这个目录结构确保了代码的清晰组织、易于维护和扩展，同时遵循了现代软件开发的最佳实践。
